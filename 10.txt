// 10. ADO.NET to insert and update data using Grid.

//.aspx

<%@ Page Language="C#" AutoEventWireup="true" CodeFile="InsertUpdate.aspx.cs" Inherits="WebApplication11.InsertUpdate" %>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>ADO.NET Insert & Update Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .grid-container { width: 60%; margin: auto; }
    </style>
</head>
<body>
    <form id="form1" runat="server">
        <div class="grid-container">
            <asp:GridView ID="gvStudents" runat="server" AutoGenerateColumns="true"
                GridLines="Both" BorderStyle="Solid" BorderWidth="1px"
                HeaderStyle-BackColor="#4CAF50" HeaderStyle-ForeColor="White">
            </asp:GridView>
            <br />
            <asp:Label ID="lblAction" runat="server" Font-Bold="true"></asp:Label>
        </div>
    </form>
</body>
</html>


//.cs

using System;
using System.Data;
using System.Data.SqlClient;

namespace WebApplication11
{
    public partial class InsertUpdate : System.Web.UI.Page
    {
        string connectionString = @"Data Source=192.168.X.Y;Initial Catalog=YourDataBaseName;User ID=your_username;Password=your_password";

        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                InsertAndUpdate();
                BindData();
            }
        }

        private void InsertAndUpdate()
        {
            using (SqlConnection con = new SqlConnection(connectionString))
            {
                con.Open();

            
                string insertQuery = "IF NOT EXISTS (SELECT * FROM Students WHERE Id=1) INSERT INTO Students (Id, Name) VALUES (1, 'Ravi')";
                new SqlCommand(insertQuery, con).ExecuteNonQuery();

                string updateQuery = "UPDATE Students SET Name='Ravi Kumar' WHERE Id=1";
                new SqlCommand(updateQuery, con).ExecuteNonQuery();

                lblAction.Text = "Inserted and Updated Successfully!";
            }
        }

        private void BindData()
        {
            DataTable dt = new DataTable();
            using (SqlConnection con = new SqlConnection(connectionString))
            {
                SqlDataAdapter da = new SqlDataAdapter("SELECT * FROM Students", con);
                da.Fill(dt);
            }

            gvStudents.DataSource = dt;
            gvStudents.DataBind();
        }
    }
}


//.designer.cs

namespace WebApplication11
{
    public partial class InsertUpdate
    {
        protected global::System.Web.UI.HtmlControls.HtmlForm form1;
        protected global::System.Web.UI.WebControls.GridView gvStudents;
        protected global::System.Web.UI.WebControls.Label lblAction;
    }
}


//SQL QUERY

USE [Your Database Name];
GO

IF OBJECT_ID('Students', 'U') IS NOT NULL
    DROP TABLE Students;
GO

CREATE TABLE Students (
    Id INT PRIMARY KEY,
    Name NVARCHAR(50)
);
GO

-- Verify table
SELECT * FROM Students;
